!function(a,b){b.Player.registerExtension("displays",{initialize:function(){var b=this;this.addEventListener("resize",function(){a.each(b.displays||[],function(a,b){b.resize&&b.resize()})})},ready:function(){var c=this;this.displays=[],this.$container.find(".smile-display").each(function(){var d=a(this).dataObject("smile"),e="Display",f=b.Display;d.track?(d.display&&(e="Display"+b.util.capitalize(d.display)),f=b[e],f?(d.track=c.getTrackById(d.track)||c.getTrackById(d.track,!0),d.container=a(this),d.player=c,c.displays.push(new f(d))):console.warn("Smile display expects valid display type: smile."+e+" not found")):console.warn("Smile display expects track parameter")})}}),b.CueDisplay=function(a){this.display=a.display,this.cue=a.cue,this.toggleDisplay=a.toggleDisplay||!1,this._activated=!1,this.render()},a.extend(b.CueDisplay.prototype,{render:function(){this.el=a("<div>").addClass("smile-cue").append(this.cue.text.replace("\n","<br/>")).attr("id",this.display.track.id+"-cue-"+this.cue.id).appendTo(this.display.$container),this._activated||this.el.hide()},activate:function(){this._activated=!0,this.el.addClass("active"),this.toggleDisplay&&this.el.show()},deactivate:function(){this._activated=!1,this.el.removeClass("active"),this.toggleDisplay&&this.el.hide()}}),b.Display=function(c){if(!c.container)throw new Error("Display needs container");this.$container=a(c.container),this.$container[0].smileDisplay=this,c.visibleOnCue&&this.$container.hide(),this.player=c.player,this.cues={},c.toggleDisplay="undefined"==typeof c.toggleDisplay?!0:!!c.toggleDisplay,c.autoLanguage="undefined"==typeof c.autoLanguage?!0:!!c.autoLanguage,this.options=c,this.lastActiveIds=[],b.util.bindAll(this,["render","onModeChange","onCueChange"]),c.track&&this.setTrack(c.track)},a.extend(b.Display.prototype,EventDispatcher.prototype,{setTrack:function(a){var b=this,c=!this.options.hideIfNative||"native"!=this.player.media.pluginType||window.TextTrack.shim;this.track&&this.unhookTrack(),this.cues={},this.track=a,c&&(this.hookTrack(),this.track.ready(function(){b.render(),b.onCueChange()}))},hookTrack:function(){this.track.addEventListener("cuechange",this.onCueChange),this.track.addEventListener("modechange",this.onModeChange)},unhookTrack:function(){this.track.removeEventListener("cuechange",this.onCueChange),this.track.removeEventListener("modechange",this.onModeChange)},render:function(a,c){{var d;this.player.media.currentTime}if("disabled"!=this.track.mode){for(a=a||0;a<(c||this.track.cues.length);a+=1)d=this.track.cues[a],this.cues[d.id]||(this.cues[d.id]=this.renderCue(d));b.Display.hookTimeLinkEvents(this.$container,this.player)}},renderCue:function(a){return new b.CueDisplay({display:this,cue:a,toggleDisplay:this.options.toggleDisplay})},onModeChange:function(){if(this.autoLanguage&&"disabled"==this.track.mode){var a=this,b=this.track.id.split("-"),c=b.slice(0,b.length-1).join("-");setTimeout(10,function(){a.setTrack(a.player.getTrackById(c,!0))})}else this.render()},onCueChange:function(){var b,c,d,e=(this.track.id+"-cue-",a.map(this.track.activeCues||[],function(a){return a.id}));for(d=0;d<e.length;d+=1)c=e[d],b=this.cues[c],console.log("ID",c,b),b&&!b._activated&&(b.activate(),this.options.pauseOnEnter&&this.player.media.pause());for(d=0;d<this.lastActiveIds.length;d+=1)c=this.lastActiveIds[d],b=this.cues[c],b&&b._activated&&-1===e.indexOf(c)&&(b.deactivate(),this.options.pauseOnExit&&this.player.media.pause());this.lastActiveIds=e,this.options.visibleOnCue&&this.$container[e.length?"show":"hide"]()},resize:function(){},getRatio:function(){return 4/3}}),b.Display.hookTimeLinkEvents=function(b,c){b.find("*[data-time]").each(function(){var b=a(this),d=parseFloat(b.attr("data-time"))+.1;b.on("click",function(a){a.preventDefault(),c.media.setCurrentTime(d)})})},b.DisplaySlides=function(a){b.Display.apply(this,[a]),this._ratio=4/3},a.extend(b.DisplaySlides.prototype,b.Display.prototype,{renderCue:function(c){var d=JSON.parse(c.text),e=b.Display.prototype.renderCue.apply(this,[c]);return e.el.empty().append(a("<img>").attr({src:d.images[0].src,title:d.title})),e},render:function(){b.Display.prototype.render.apply(this);for(var a,c=[],d=0;d<this.track.cues.length;d+=1)a=JSON.parse(this.track.cues[d].text),a.images&&a.images.length&&a.images[0].width&&a.images[0].height&&c.push(a.images[0].width/a.images[0].height);c.length&&(c.sort(function(a,b){return a-b}),this._ratio=c[Math.floor(c.length/2)])},getRatio:function(){return this._ratio}})}(jQuery,smile);